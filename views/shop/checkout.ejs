<%- include('../includes/head.ejs') %>
</head>
<body>
    <%- include('../includes/navigation.ejs')%>
    <% 
    <!-- let total=0; -->
    products.forEach(p=>{
        %>
        <div class="d-flex flex-row justify-content-between align-items-center p-2 bg-white mt-4 px-3 rounded">
            <div class="mr-1 cart-image col-1">
                <img class="rounded" src="<%= p.productId.imageUrl %>" alt="Image Cap" width="70">
            </div>
            <div class="d-flex flex-column col-2">
                <%= p.productId.title %>
            </div>
            <div class="d-flex flex-row align-items-center qty col-2">
                <form action="/cart-update-qty" method="POST" class="ms-auto">
                    <input type="hidden" name="_csrf" value="<%= csrfToken%>">
                    <input type="hidden" name="productId" value="<%= p.productId._id %>">
                    <input type="hidden" name="incrQty" value="false">
                    <button type="submit" class="btn btn-light fa fa-minus text-danger"></button>
                </form>                                
                <span class="text-grey mx-2"><%= p.quantity %></span>
                <form action="/cart-update-qty" method="POST" class="ms-auto">
                    <input type="hidden" name="_csrf" value="<%= csrfToken%>">
                    <input type="hidden" name="productId" value="<%= p.productId._id %>">
                    <input type="hidden" name="incrQty" value="true">
                    <button type="submit" class="btn btn-light fa fa-plus text-success"></button>
                </form>
                
            </div>
            <div class="col-1">
                $<%= p.productId.price %>
            </div >
            <div class="col-1">
                $<%= parseFloat(p.productId.price * p.quantity).toFixed(2) %>
            </div>
            <div class="d-flex align-items-center col-1">
                <form action="/cart-delete-item" method="POST" class="ms-auto">
                    <input type="hidden" name="_csrf" value="<%= csrfToken%>">
                    <input type="hidden" name="productId" value="<%= p.productId._id %>">
                    <button type="submit" class="btn btn-light text-danger fa fa-trash">
                    </button>
                </form> 
                
            </div>
        </div>
    <% 
    <!-- total=p.productId.price * p.quantity + total; -->
}) %>
<div class="d-flex flex-row justify-content-between align-items-center p-2 bg-white mt-4 px-3 rounded">
    <span>Total:</span>
    <h5>$<%= parseFloat(totalSum).toFixed(2) %></h5>
</div>
    <div >
        <input type="hidden" name="_csrf" value="<%= csrfToken%>">
        <button id="order-btn" class="btn btn-primary btn-custom-primary float-end mt-3 px-3 btn-custome" type="submit">
            Order Now
        </button>
        <script src="https://js.stripe.com/v3/"></script>
        <script>
            var stripe=Stripe('<%=STRIPE_PK%>');
            var orderBtn=document.getElementById('order-btn');
            orderBtn.addEventListener('click',function(){
                stripe.redirectToCheckout({
                    sessionId:'<%= sessionId %>'
                })
            })
        </script>
    </div>    
</div>  

<%- include('../includes/end.ejs') %>
